generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             Int             @id @default(autoincrement())
  email          String          @unique
  password       String
  role           UserRole
  brandProfile   BrandProfile?
  creatorProfile CreatorProfile?
  createdAt      DateTime        @default(now())

  @@index([email])
}

model BrandProfile {
  id           Int              @id @default(autoincrement())
  userId       Int              @unique
  user         User             @relation(fields: [userId], references: [id])
  name         String
  description  String?
  industry     IndustryCategory @default(OTHER)
  websiteUrl   String?
  contactEmail String?
  products     Product[]
  campaigns    Campaign[]
  apiKey       String?           @unique
  createdAt    DateTime         @default(now())
  updatedAt    DateTime?        @updatedAt
}

model CreatorProfile {
  id        Int               @id @default(autoincrement())
  userId    Int               @unique
  user      User              @relation(fields: [userId], references: [id])
  name      String
  bio       String?
  niche     CreatorNiche
  campaigns CampaignMember[]
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}

model Product {
  id         Int           @id @default(autoincrement())
  brandId    Int
  brand      BrandProfile  @relation(fields: [brandId], references: [id])
  name       String
  basePrice  Float
  skuId      String
  productUrl String
  currency   Currency      @default(INR)
  status     ProductStatus @default(AVAILABLE)

  campaignProducts CampaignProduct[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  @@unique([brandId, skuId])
}

model Campaign {
  id          Int          @id @default(autoincrement())
  brandId     Int
  brand       BrandProfile @relation(fields: [brandId], references: [id])
  name        String
  description String?

  status      CampaignStatus @default(DRAFT)
  redirectUrl String

  products          CampaignProduct[]
  invites           CampaignInvite[]
  members           CampaignMember[]
  // CPS and CPC settings
  currency Currency @default(INR)
  payoutModel       PayoutModel       @default(BOTH)
  cpsCommissionType CommissionType
  cpsValue          Float
  cpcValue          Float?

  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model CampaignProduct {
  id         Int @id @default(autoincrement())
  campaignId Int
  productId  Int

  campaign Campaign    @relation(fields: [campaignId], references: [id])
  product  Product     @relation(fields: [productId], references: [id])
  sales    SaleEvent[]

  @@unique([campaignId, productId])
}

model CampaignInvite {
  id         Int          @id @default(autoincrement())
  campaignId Int
  campaign   Campaign     @relation(fields: [campaignId], references: [id])
  email      String
  status     InviteStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([campaignId, email])
}

model CampaignMember {
  id Int @id @default(autoincrement())

  campaignId Int
  creatorId  Int

  referralCodes ReferralCode[]

  campaign Campaign       @relation(fields: [campaignId], references: [id])
  creator  CreatorProfile @relation(fields: [creatorId], references: [id])

  sales     SaleEvent[]
  clicks    ClickEvent[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@unique([campaignId, creatorId])
}

model ReferralCode {
  id       Int            @id @default(autoincrement())
  memberId Int
  member   CampaignMember @relation(fields: [memberId], references: [id])

  platform PlatformType
  code     String       @unique

  createdAt DateTime @default(now())

  @@unique([memberId, platform])
}

model SaleEvent {
  id        Int            @id @default(autoincrement())
  salePrice Float
  currency  Currency       @default(INR)
  memberId  Int
  member    CampaignMember @relation(fields: [memberId], references: [id])

  campaignProductId Int
  campaignProduct   CampaignProduct @relation(fields: [campaignProductId], references: [id])
  platform          PlatformType
  purchasedAt       DateTime        @default(now())
}

model ClickEvent {
  id        Int            @id @default(autoincrement())
  memberId  Int
  ipAddress String?
  member    CampaignMember @relation(fields: [memberId], references: [id])
  platform  PlatformType
  timestamp DateTime       @default(now())
}

enum UserRole {
  BRAND
  CREATOR
  ADMIN
}

enum IndustryCategory {
  TECHNOLOGY
  CONSUMER_GOODS
  FOOD_AND_HEALTH
  ENTERTAINMENT
  TRAVEL_AND_HOSPITALITY
  FINANCE
  AUTOMOTIVE
  EDUCATION
  REAL_ESTATE
  PARENTING
  OTHER
}

enum CreatorNiche {
  FASHION
  BEAUTY
  TECH
  GAMING
  FITNESS
  LIFESTYLE
  FOOD
  TRAVEL
  EDUCATION
  OTHER
}

enum PlatformType {
  INSTAGRAM
  YOUTUBE
  X
  LINKEDIN
  FACEBOOK
  OTHER
}

enum Currency {
  INR
}

enum ProductStatus {
  AVAILABLE
  UNAVAILABLE
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  COMPLETED
}

enum InviteStatus {
  PENDING
  ACCEPTED
}

enum PayoutModel {
  CPS // cost per sale only
  CPC // cost per click only
  BOTH // mix of CPS + CPC
}

enum CommissionType {
  PERCENTAGE
  FIXED
}
 