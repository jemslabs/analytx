generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             Int             @id @default(autoincrement())
  email          String          @unique
  password       String
  role           UserRole
  brandProfile   BrandProfile?
  creatorProfile CreatorProfile?
  createdAt      DateTime        @default(now())

  @@index([email])
}

model BrandProfile {
  id           Int              @id @default(autoincrement())
  userId       Int              @unique
  user         User             @relation(fields: [userId], references: [id])
  name         String
  slug         String           @unique
  description  String?
  industry     IndustryCategory @default(OTHER)
  websiteUrl   String?
  contactEmail String?
  verified     Boolean          @default(false)
  products     Product[]
  campaigns    Campaign[]
  createdAt    DateTime         @default(now())
  updatedAt    DateTime?        @updatedAt
}

model CreatorProfile {
  id        Int               @id @default(autoincrement())
  userId    Int               @unique
  user      User              @relation(fields: [userId], references: [id])
  name      String
  slug      String            @unique
  bio       String?
  niche     CreatorNiche
  platforms CreatorPlatform[]
  campaigns CampaignMember[]
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}

model CreatorPlatform {
  id        Int            @id @default(autoincrement())
  creatorId Int
  creator   CreatorProfile @relation(fields: [creatorId], references: [id])
  platform  PlatformType
  username  String
  url       String
  followers Int
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
}

model Product {
  id         Int           @id @default(autoincrement())
  brandId    Int
  brand      BrandProfile  @relation(fields: [brandId], references: [id])
  name       String
  basePrice  Float
  skuId      String
  productUrl String
  currency   Currency      @default(INR)
  status     ProductStatus @default(AVAILABLE)

  campaignProducts CampaignProduct[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  @@unique([brandId, skuId])
}

model Campaign {
  id          Int          @id @default(autoincrement())
  brandId     Int
  brand       BrandProfile @relation(fields: [brandId], references: [id])
  name        String
  description String?

  startDate DateTime
  endDate   DateTime?
  status    CampaignStatus @default(DRAFT)
  redirectUrl String
  products  CampaignProduct[]
  invites   CampaignInvite[]
  members   CampaignMember[]
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}

model CampaignProduct {
  id         Int @id @default(autoincrement())
  campaignId Int
  productId  Int

  campaign Campaign @relation(fields: [campaignId], references: [id])
  product  Product  @relation(fields: [productId], references: [id])

  @@unique([campaignId, productId])
}

model CampaignInvite {
  id         Int          @id @default(autoincrement())
  campaignId Int
  campaign   Campaign     @relation(fields: [campaignId], references: [id])
  email      String
  status     InviteStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([campaignId, email])
}

model CampaignMember {
  id Int @id @default(autoincrement())

  campaignId Int
  creatorId  Int

  // Unique tracking code per assigned creator
  referralCode String @unique

  campaign Campaign       @relation(fields: [campaignId], references: [id])
  creator  CreatorProfile @relation(fields: [creatorId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([campaignId, creatorId])
}

enum UserRole {
  BRAND
  CREATOR
  ADMIN
}

enum IndustryCategory {
  TECHNOLOGY
  CONSUMER_GOODS
  FOOD_AND_HEALTH
  ENTERTAINMENT
  TRAVEL_AND_HOSPITALITY
  FINANCE
  AUTOMOTIVE
  EDUCATION
  REAL_ESTATE
  PARENTING
  OTHER
}

enum CreatorNiche {
  FASHION
  BEAUTY
  TECH
  GAMING
  FITNESS
  LIFESTYLE
  FOOD
  TRAVEL
  EDUCATION
  OTHER
}

enum PlatformType {
  INSTAGRAM
  YOUTUBE
  TWITTER
  LINKEDIN
  FACEBOOK
  OTHER
}

enum Currency {
  INR
}

enum ProductStatus {
  AVAILABLE
  UNAVAILABLE
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  COMPLETED
}

enum InviteStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
}
